<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Task</title>
    <script type="text/javascript" src="/eel.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        select,
        input,
        button {
            margin: 10px;
            padding: 5px;
            font-size: 16px;
        }

        .hidden {
            display: none;
        }

        #plot {
            max-width: 100%;
            margin-top: 20px;
            display: none;
        }

        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 80%;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }

        th {
            background-color: #f2f2f2;
        }

        .result-container {
            margin: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <h2>Select a Task:</h2>
    <select id="task" onchange="updateForm()">
        <option value="task1">Task 1: Graphical Method</option>
        <option value="task2">Task 2: Root-Finding Methods</option>
        <option value="task3">Task 3: Relaxation Method</option>
        <option value="task4">Task 4: Eigenvalues (Power Method)</option>
        <option value="task5">Task 5: Exponential Curve Fitting</option>
        <option value="task6">Task 6: Cubic Spline Interpolation</option>
        <option value="task7">Task 7: Picard's Method</option>
        <option value="task8">Task 8: Simpson's 1/3 Rule</option>
    </select>

    <div id="task1_form">
        <h2>Graphical Method</h2>

        <h3>Step 1: Plot the Graph</h3>
        <input type="text" id="function" placeholder="Enter f(x)">
        <input type="text" id="range" placeholder="Range of x (e.g., -4,4)">
        <button onclick="drawGraph()">Plot Graph</button>

        <h3>Step 2: Find Roots</h3>
        <input type="text" id="initial_guesses" placeholder="Enter initial guesses (e.g., -3,-1,1,3)">
        <button onclick="findRoots()">Find Roots</button>

        <h3>Result:</h3>
        <p id="result"></p>

        <img id="plot" src="plot.png" alt="Function Plot">
    </div>

    <div id="task2_form" class="hidden">
        <h3>Root-Finding Methods</h3>
        <input type="text" id="function2" placeholder="Enter f(x)">
        <input type="text" id="range2" placeholder="Interval (e.g., 0,3)">
        <button onclick="findRootsFor2Task()">Find Roots</button>
        <p id="result2"></p>
    </div>

    <div id="task3_form" class="hidden">
        <h3>Solving a System of Equations using the Relaxation Method</h3>
        <label for="matrix">Enter Matrix A:</label>
        <input type="text" id="matrix" placeholder="e.g., [[10,-1,2,0],[-1,11,-1,3],[2,-1,10,-1],[0,3,-1,8]]">

        <label for="rhs">Enter Vector b:</label>
        <input type="text" id="rhs" placeholder="e.g., [6,25,-11,15]">

        <label for="omega">Enter Relaxation Parameter (omega):</label>
        <input type="text" id="omega" placeholder="e.g., 1.2">

        <button onclick="solveRelaxation()">Solve</button>

        <div class="result-container">
            <h3>Result:</h3>
            <p id="result3"></p>
            <div id="iterationTable3"></div>
        </div>
    </div>

    <div id="task4_form" class="hidden">
        <h3>Power Method for Eigenvalues</h3>

        <label for="matrix_eigen">Enter Matrix A:</label>
        <input type="text" id="matrix_eigen" placeholder="e.g., [[4,1],[2,3]]">

        <button onclick="solvePowerMethod()">Find Eigenvalue</button>

        <div class="result-container">
            <h3>Result:</h3>
            <p id="result4"></p>
            <img id="convergencePlot4" src="convergence_plot.png" alt="Convergence Plot"
                style="max-width: 100%; margin-top: 20px;">
        </div>
    </div>

    <!-- <h3>Result:</h3>
    <p id="result"></p>

    <img id="plot" src="plot.png" alt="Function Plot"> -->

    <script>
        function drawGraph() {
            let func = document.getElementById("function").value;
            let range = document.getElementById("range").value;

            eel.plot_function(func, range)(function (response) {
                document.getElementById("result").innerText = response;
                document.getElementById("plot").src = "plot.png?rand=" + Math.random(); // Refresh image
                document.getElementById("plot").style.display = "block";
            });
        }

        function findRoots() {
            let func = document.getElementById("function").value;
            let guesses = document.getElementById("initial_guesses").value;

            eel.find_roots(func, guesses)(function (response) {
                document.getElementById("result").innerText = response;
            });
        }

        function updateForm() {
            document.querySelectorAll("div[id$='_form']").forEach(div => div.classList.add("hidden"));
            let selectedTask = document.getElementById("task").value;
            document.getElementById(selectedTask + "_form").classList.remove("hidden");
        }

        function findRootsFor2Task() {
            let func = document.getElementById("function2").value;
            let range = document.getElementById("range2").value;
            eel.evaluate_methods(func, range)(function (response) {
                document.getElementById("result2").innerText = response;
            });
        }

        function solveRelaxation() {
            let matrix = document.getElementById("matrix").value;
            let rhs = document.getElementById("rhs").value;
            let omega = parseFloat(document.getElementById("omega").value);

            try {
                let A = JSON.parse(matrix);
                let b = JSON.parse(rhs);

                eel.relaxation_method(A, b, omega)(function (response) {
                    if (response.error) {
                        document.getElementById("result3").innerText = response.error;
                        return;
                    }

                    document.getElementById("result3").innerText = `Final Solution: ${JSON.stringify(response.solution.map(x => x.toFixed(6)))}`;

                    // Create table
                    let tableHtml = '<table><tr><th>Iteration</th>';
                    for (let i = 0; i < response.solution.length; i++) {
                        tableHtml += `<th>x${i + 1}</th>`;
                    }
                    tableHtml += '</tr>';

                    response.table.forEach((row, idx) => {
                        tableHtml += `<tr><td>${idx * 10}</td>`;
                        row.forEach(val => {
                            tableHtml += `<td>${val.toFixed(6)}</td>`;
                        });
                        tableHtml += '</tr>';
                    });
                    tableHtml += '</table>';

                    document.getElementById("iterationTable3").innerHTML = tableHtml;
                });
            } catch (error) {
                document.getElementById("result3").innerText = "Error: Invalid input!";
            }
        }

        function solvePowerMethod() {
            let matrix = document.getElementById("matrix_eigen").value.trim();

            try {
                let A = JSON.parse(matrix);

                if (!Array.isArray(A) || A.length === 0 || !Array.isArray(A[0])) {
                    throw new Error("Matrix A must be a two-dimensional array.");
                }

                eel.power_method(A)(function (response) {
                    if (response.error) {
                        document.getElementById("result4").innerText = response.error;
                        return;
                    }

                    let eigenvalue = response.eigenvalue;
                    let eigenvector = response.eigenvector;

                    document.getElementById("result4").innerHTML =
                        `<strong>Eigenvalue:</strong> ${eigenvalue.toFixed(6)}<br>
                         <strong>Eigenvector:</strong> [${eigenvector.map(x => x.toFixed(6)).join(", ")}]<br>
                         <strong>Iterations:</strong> ${response.iterations}`;

                    // Refresh the convergence plot
                    document.getElementById("convergencePlot4").src = "convergence_plot.png?rand=" + Math.random();
                });
            } catch (error) {
                document.getElementById("result4").innerText = "Error: " + error.message;
            }
        }
    </script>
</body>

</html>